<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Order History</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Order History</h1>
    <div id="orders">
        <!-- Order details will be shown here -->
    </div>

    <script>
        // Function to get the order history from localStorage
        function getOrderHistory() {
            return JSON.parse(localStorage.getItem('orderHistory')) || [];
        }

        // Function to save the order history to localStorage
        function saveOrderHistory(orders) {
            localStorage.setItem('orderHistory', JSON.stringify(orders));
        }

        // Function to display the order history
        function displayOrderHistory() {
            const orders = getOrderHistory();
            const container = document.getElementById('orders');

            // Check if there are any orders
            if (orders.length === 0) {
                container.innerHTML = "<p>You have no previous orders.</p>";
            } else {
                // Display each order
                orders.forEach(order => {
                    const div = document.createElement('div');
                    div.innerHTML = `
                        <h3>Order #${order.id} - £${order.total_amount}</h3>
                        <p>Date: ${order.order_date}</p>
                        <ul>
                            ${order.items.map(item => `<li>${item.product_name} x${item.quantity} - £${item.price}</li>`).join('')}
                        </ul>
                    `;
                    container.appendChild(div);
                });
            }
        }

        // Function to process the checkout and add the order to history
        function checkout() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            if (cart.length === 0) {
                alert("Your cart is empty. Please add items to your cart before proceeding.");
                return;
            }

            const orderDetails = {
                id: new Date().getTime(), // Unique order ID based on timestamp
                total_amount: cart.reduce((total, item) => total + (item.price * 1), 0).toFixed(2), // Sum of all items
                order_date: new Date().toLocaleDateString(),
                items: cart.map(item => ({
                    product_name: item.name,
                    quantity: 1, // Assuming 1 of each item in the cart for simplicity
                    price: item.price
                }))
            };

            // Save the new order to the order history
            let orderHistory = getOrderHistory();
            orderHistory.push(orderDetails);
            saveOrderHistory(orderHistory);

            // Clear the cart after checkout
            localStorage.setItem('cart', JSON.stringify([]));

            alert("Your order has been placed successfully!");
            window.location.href = "order_history.html"; // Redirect to order history page after checkout
        }

        // Function to simulate the checkout process (trigger this when user clicks 'Proceed to Checkout')
        function simulateCheckout() {
            checkout();
        }

        // Call simulateCheckout() when the checkout process happens
        // In a real checkout process, you'd replace this with actual checkout functionality
        // For now, you can simulate it with a button or when proceeding to checkout
        window.onload = function() {
            displayOrderHistory();
        };

    </script>
</body>
</html>
